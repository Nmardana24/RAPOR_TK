<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Rapor KB/TK Gelora Bangsa</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .nav-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        .nav-tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .nav-tab.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        .tab-content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.delete {
            background-color: #e74c3c;
        }
        button.delete:hover {
            background-color: #c0392b;
        }
        .evaluation-table {
            width: 100%;
        }
        .evaluation-table th {
            background-color: #3498db;
            color: white;
        }
        .evaluation-table td {
            vertical-align: top;
        }
        .report-card {
            border: 2px solid #2c3e50;
            padding: 30px;
            background-color: white;
            margin-top: 20px;
        }
        .report-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 20px;
        }
        .student-info {
            margin-bottom: 20px;
        }
        .evaluation-section {
            margin-bottom: 30px;
        }
        .evaluation-section h3 {
            background-color: #f2f2f2;
            padding: 10px;
            border-left: 4px solid #3498db;
        }
        .teacher-notes {
            margin-top: 30px;
        }
        .signature-area {
            margin-top: 50px;
            display: flex;
            justify-content: space-between;
        }
        .signature-box {
            text-align: center;
            width: 45%;
        }
        .signature-line {
            border-top: 1px solid #2c3e50;
            margin-top: 60px;
            padding-top: 5px;
        }
        .print-button {
            text-align: center;
            margin-top: 20px;
        }
        .school-info {
            text-align: center;
            margin-bottom: 20px;
        }
        .student-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .attendance-table {
            font-size: 0.9em;
        }
        .attendance-table th, .attendance-table td {
            padding: 5px;
            text-align: center;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .report-card, .report-card * {
                visibility: visible;
            }
            .report-card {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                border: none;
                padding: 0;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="school-info">
            <h1>KB - TK GELORA BANGSA</h1>
            <p>Jl. Kampung Baru Kubur Koja, Penjaringan, JAKARTA UTARA</p>
            <p>Email: gelorabangsaa@gmail.com | NPSN: 69900048</p>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="siswa">Data Siswa</div>
            <div class="nav-tab" data-tab="nilai">Input Nilai</div>
            <div class="nav-tab" data-tab="absensi">Absensi</div>
            <div class="nav-tab" data-tab="rapor">Lihat Rapor</div>
        </div>
        
        <!-- Tab Data Siswa -->
        <div id="siswa" class="tab-content active">
            <h2>Data Siswa</h2>
            <div class="form-group">
                <label for="nama">Nama Lengkap:</label>
                <input type="text" id="nama" placeholder="Masukkan nama lengkap">
            </div>
            <div class="form-group">
                <label for="jenis-kelamin">Jenis Kelamin:</label>
                <select id="jenis-kelamin">
                    <option value="L">Laki-laki</option>
                    <option value="P">Perempuan</option>
                </select>
            </div>
            <div class="form-group">
                <label for="tempat-lahir">Tempat Lahir:</label>
                <input type="text" id="tempat-lahir" placeholder="Masukkan tempat lahir">
            </div>
            <div class="form-group">
                <label for="tanggal-lahir">Tanggal Lahir:</label>
                <input type="date" id="tanggal-lahir">
            </div>
            <div class="form-group">
                <label for="alamat">Alamat:</label>
                <textarea id="alamat" rows="3" placeholder="Masukkan alamat lengkap"></textarea>
            </div>
            <div class="form-group">
                <label for="nama-ayah">Nama Ayah:</label>
                <input type="text" id="nama-ayah" placeholder="Masukkan nama ayah">
            </div>
            <div class="form-group">
                <label for="nama-ibu">Nama Ibu:</label>
                <input type="text" id="nama-ibu" placeholder="Masukkan nama ibu">
            </div>
            <div class="form-group">
                <label for="nama-panggilan">Nama Panggilan:</label>
                <input type="text" id="nama-panggilan" placeholder="Masukkan nama panggilan">
            </div>
            <div class="form-group">
                <label for="nisn">NISN:</label>
                <input type="text" id="nisn" placeholder="Masukkan NISN">
            </div>
            <div class="form-group">
                <label for="nis">NIS:</label>
                <input type="text" id="nis" placeholder="Masukkan NIS">
            </div>
            <div class="form-group">
                <label for="agama">Agama:</label>
                <select id="agama">
                    <option value="ISLAM">ISLAM</option>
                    <option value="KRISTEN">KRISTEN</option>
                    <option value="KATOLIK">KATOLIK</option>
                    <option value="HINDU">HINDU</option>
                    <option value="BUDDHA">BUDDHA</option>
                    <option value="KONGHUCU">KONGHUCU</option>
                </select>
            </div>
            <div class="form-group">
                <label for="anak-ke">Anak Ke:</label>
                <input type="number" id="anak-ke" placeholder="Masukkan urutan anak">
            </div>
            <div class="form-group">
                <label for="pekerjaan-ayah">Pekerjaan Ayah:</label>
                <input type="text" id="pekerjaan-ayah" placeholder="Masukkan pekerjaan ayah">
            </div>
            <div class="form-group">
                <label for="pekerjaan-ibu">Pekerjaan Ibu:</label>
                <input type="text" id="pekerjaan-ibu" placeholder="Masukkan pekerjaan ibu">
            </div>
            <div class="form-group">
                <label for="no-telp">No. Telepon:</label>
                <input type="text" id="no-telp" placeholder="Masukkan nomor telepon">
            </div>
            <button id="tambah-siswa">Tambah Siswa</button>
            
            <h3>Daftar Siswa</h3>
            <div class="student-list">
                <table id="tabel-siswa">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama</th>
                            <th>Jenis Kelamin</th>
                            <th>Tempat/Tgl Lahir</th>
                            <th>Nama Panggilan</th>
                            <th>NISN/NIS</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data siswa akan ditampilkan di sini -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Tab Input Nilai -->
        <div id="nilai" class="tab-content">
            <h2>Input Nilai Perkembangan</h2>
            <div class="form-group">
                <label for="pilih-siswa">Pilih Siswa:</label>
                <select id="pilih-siswa">
                    <option value="">-- Pilih Siswa --</option>
                </select>
            </div>
            
            <div id="form-nilai" style="display: none;">
                <h3>Aspek Perkembangan</h3>
                
                <div class="evaluation-section">
                    <h4>I. Nilai Agama Dan Budi Pekerti</h4>
                    <div class="form-group">
                        <label for="nilai-agama">Deskripsi Perkembangan:</label>
                        <textarea id="nilai-agama" rows="6" placeholder="Masukkan deskripsi perkembangan nilai agama dan budi pekerti"></textarea>
                    </div>
                </div>
                
                <div class="evaluation-section">
                    <h4>II. Jati Diri</h4>
                    <div class="form-group">
                        <label for="nilai-jati-diri">Deskripsi Perkembangan:</label>
                        <textarea id="nilai-jati-diri" rows="6" placeholder="Masukkan deskripsi perkembangan jati diri"></textarea>
                    </div>
                </div>
                
                <div class="evaluation-section">
                    <h4>III. Dasar Literasi, Matematika, Sains, Teknologi, Rekayasa, dan Seni</h4>
                    <div class="form-group">
                        <label for="nilai-literasi">Deskripsi Perkembangan:</label>
                        <textarea id="nilai-literasi" rows="6" placeholder="Masukkan deskripsi perkembangan dasar literasi, matematika, sains, teknologi, rekayasa, dan seni"></textarea>
                    </div>
                </div>
                
                <div class="evaluation-section">
                    <h4>B. KOKURIKULER - I. Proyek Penguatan Profil Pelajar Pancasila</h4>
                    <div class="form-group">
                        <label for="nilai-kokurikuler">Deskripsi Perkembangan:</label>
                        <textarea id="nilai-kokurikuler" rows="6" placeholder="Masukkan deskripsi perkembangan kokurikuler"></textarea>
                    </div>
                </div>
                
                <div class="evaluation-section">
                    <h4>C. Tinggi dan Berat Badan</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Aspek</th>
                                <th>Semester 1</th>
                                <th>Semester 2</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Tinggi Badan (cm)</td>
                                <td><input type="number" id="tinggi-sem1" placeholder="cm"></td>
                                <td><input type="number" id="tinggi-sem2" placeholder="cm"></td>
                            </tr>
                            <tr>
                                <td>Berat Badan (kg)</td>
                                <td><input type="number" id="berat-sem1" placeholder="kg"></td>
                                <td><input type="number" id="berat-sem2" placeholder="kg"></td>
                            </tr>
                            <tr>
                                <td>Lingkar Kepala (cm)</td>
                                <td><input type="number" id="lingkar-sem1" placeholder="cm"></td>
                                <td><input type="number" id="lingkar-sem2" placeholder="cm"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="evaluation-section">
                    <h4>D. Kondisi Kesehatan</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Aspek</th>
                                <th>Keterangan</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Pendengaran</td>
                                <td><input type="text" id="kesehatan-pendengaran" placeholder="Keterangan pendengaran"></td>
                            </tr>
                            <tr>
                                <td>Penglihatan</td>
                                <td><input type="text" id="kesehatan-penglihatan" placeholder="Keterangan penglihatan"></td>
                            </tr>
                            <tr>
                                <td>Gigi</td>
                                <td><input type="text" id="kesehatan-gigi" placeholder="Keterangan gigi"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="evaluation-section">
                    <h4>F. Tingkat Kehadiran</h4>
                    <div class="form-group">
                        <label for="sakit">Sakit:</label>
                        <input type="number" id="sakit" placeholder="Jumlah hari sakit">
                    </div>
                    <div class="form-group">
                        <label for="izin">Izin:</label>
                        <input type="number" id="izin" placeholder="Jumlah hari izin">
                    </div>
                    <div class="form-group">
                        <label for="tanpa-keterangan">Tanpa Keterangan:</label>
                        <input type="number" id="tanpa-keterangan" placeholder="Jumlah hari tanpa keterangan">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="catatan-guru">Catatan Guru:</label>
                    <textarea id="catatan-guru" rows="4" placeholder="Masukkan catatan guru"></textarea>
                </div>
                
                <button id="simpan-nilai">Simpan Nilai</button>
            </div>
        </div>
        
        <!-- Tab Absensi -->
        <div id="absensi" class="tab-content">
            <h2>Absensi Siswa</h2>
            <div class="form-group">
                <label for="bulan-absensi">Pilih Bulan:</label>
                <select id="bulan-absensi">
                    <option value="1">Januari</option>
                    <option value="2">Februari</option>
                    <option value="3">Maret</option>
                    <option value="4">April</option>
                    <option value="5">Mei</option>
                    <option value="6">Juni</option>
                    <option value="7">Juli</option>
                    <option value="8">Agustus</option>
                    <option value="9">September</option>
                    <option value="10">Oktober</option>
                    <option value="11">November</option>
                    <option value="12">Desember</option>
                </select>
            </div>
            <div class="form-group">
                <label for="tahun-absensi">Tahun:</label>
                <input type="number" id="tahun-absensi" value="2025" min="2020" max="2030">
            </div>
            
            <div id="tabel-absensi-container">
                <!-- Tabel absensi akan ditampilkan di sini -->
            </div>
            
            <button id="simpan-absensi">Simpan Absensi</button>
        </div>
        
        <!-- Tab Lihat Rapor -->
        <div id="rapor" class="tab-content">
            <h2>Lihat dan Cetak Rapor</h2>
            <div class="form-group">
                <label for="pilih-siswa-rapor">Pilih Siswa:</label>
                <select id="pilih-siswa-rapor">
                    <option value="">-- Pilih Siswa --</option>
                </select>
            </div>
            
            <div id="tampilan-rapor" style="display: none;">
                <div class="print-button no-print">
                    <button onclick="window.print()">Cetak Rapor</button>
                </div>
                
                <div class="report-card">
                    <div class="report-header">
                        <h2>LAPORAN CAPAIAN PEMBELAJARAN</h2>
                        <h3>KB/TK GELORA BANGSA</h3>
                        <p>TAHUN AJARAN: <span id="tahun-ajaran">2024/2025</span> | SEMESTER: <span id="semester-rapor">1 (Satu)</span></p>
                    </div>
                    
                    <div class="student-info">
                        <table>
                            <tr>
                                <td width="150">Nama</td>
                                <td width="10">:</td>
                                <td id="nama-rapor"></td>
                            </tr>
                            <tr>
                                <td>Nama Panggilan</td>
                                <td>:</td>
                                <td id="nama-panggilan-rapor"></td>
                            </tr>
                            <tr>
                                <td>NISN / NIS</td>
                                <td>:</td>
                                <td id="nisn-nis-rapor"></td>
                            </tr>
                            <tr>
                                <td>Jenis Kelamin</td>
                                <td>:</td>
                                <td id="jenis-kelamin-rapor"></td>
                            </tr>
                            <tr>
                                <td>Tempat, Tanggal Lahir</td>
                                <td>:</td>
                                <td id="ttl-rapor"></td>
                            </tr>
                            <tr>
                                <td>Agama</td>
                                <td>:</td>
                                <td id="agama-rapor"></td>
                            </tr>
                            <tr>
                                <td>Anak Ke</td>
                                <td>:</td>
                                <td id="anak-ke-rapor"></td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="evaluation-section">
                        <h3>A. INTRAKURIKULER</h3>
                        
                        <h4>I. Nilai Agama Dan Budi Pekerti</h4>
                        <p id="rapor-agama"></p>
                        
                        <h4>II. Jati Diri</h4>
                        <p id="rapor-jati-diri"></p>
                        
                        <h4>III. Dasar Literasi, Matematika, Sains, Teknologi, Rekayasa, dan Seni</h4>
                        <p id="rapor-literasi"></p>
                    </div>
                    
                    <div class="evaluation-section">
                        <h3>B. KOKURIKULER</h3>
                        
                        <h4>I. Proyek Penguatan Profil Pelajar Pancasila</h4>
                        <p id="rapor-kokurikuler"></p>
                    </div>
                    
                    <div class="evaluation-section">
                        <h3>C. Tinggi dan Berat Badan</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Aspek</th>
                                    <th>Semester 1</th>
                                    <th>Semester 2</th>
                                </tr>
                            </thead>
                            <tbody id="rapor-fisik">
                                <!-- Data fisik akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="evaluation-section">
                        <h3>D. Kondisi Kesehatan</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Aspek</th>
                                    <th>Keterangan</th>
                                </tr>
                            </thead>
                            <tbody id="rapor-kesehatan">
                                <!-- Data kesehatan akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="evaluation-section">
                        <h3>F. Tingkat Kehadiran</h3>
                        <p>Sakit: <span id="rapor-sakit"></span> hari</p>
                        <p>Izin: <span id="rapor-izin"></span> hari</p>
                        <p>Tanpa Keterangan: <span id="rapor-tanpa-keterangan"></span> hari</p>
                    </div>
                    
                    <div class="teacher-notes">
                        <h3>CATATAN GURU</h3>
                        <p id="catatan-guru-rapor"></p>
                    </div>
                    
                    <div class="signature-area">
                        <div class="signature-box">
                            <p>Orang Tua/Wali</p>
                            <div class="signature-line"></div>
                        </div>
                        <div class="signature-box">
                            <p>Guru Kelas</p>
                            <div class="signature-line"></div>
                            <p id="nama-guru-kelas">RINI</p>
                        </div>
                    </div>
                    
                    <div class="signature-area" style="margin-top: 30px;">
                        <div class="signature-box">
                            <p>Mengetahui,</p>
                            <p>Kepala KB - TK Gelora Bangsa</p>
                            <div class="signature-line" style="margin-top: 80px;"></div>
                            <p>Rina S.E</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let siswaData = JSON.parse(localStorage.getItem('siswaData')) || [];
        let nilaiData = JSON.parse(localStorage.getItem('nilaiData')) || [];
        let absensiData = JSON.parse(localStorage.getItem('absensiData')) || [];
        
        // DOM Elements
        const tabButtons = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Tab switching
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                // Remove active class from all tabs and contents
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Add active class to current tab and content
                button.classList.add('active');
                document.getElementById(tabId).classList.add('active');
                
                // Refresh data if needed
                if (tabId === 'nilai') {
                    refreshSiswaDropdown();
                } else if (tabId === 'rapor') {
                    refreshSiswaDropdownRapor();
                } else if (tabId === 'absensi') {
                    generateAbsensiTable();
                }
            });
        });
        
        // Function to refresh siswa dropdown for nilai tab
        function refreshSiswaDropdown() {
            const selectSiswa = document.getElementById('pilih-siswa');
            selectSiswa.innerHTML = '<option value="">-- Pilih Siswa --</option>';
            
            siswaData.forEach(siswa => {
                const option = document.createElement('option');
                option.value = siswa.id;
                option.textContent = siswa.nama;
                selectSiswa.appendChild(option);
            });
        }
        
        // Function to refresh siswa dropdown for rapor tab
        function refreshSiswaDropdownRapor() {
            const selectSiswa = document.getElementById('pilih-siswa-rapor');
            selectSiswa.innerHTML = '<option value="">-- Pilih Siswa --</option>';
            
            siswaData.forEach(siswa => {
                const option = document.createElement('option');
                option.value = siswa.id;
                option.textContent = siswa.nama;
                selectSiswa.appendChild(option);
            });
        }
        
        // Show nilai form when siswa is selected
        document.getElementById('pilih-siswa').addEventListener('change', function() {
            const formNilai = document.getElementById('form-nilai');
            if (this.value) {
                formNilai.style.display = 'block';
                
                // Load existing nilai if available
                const existingNilai = nilaiData.find(n => n.siswaId === this.value);
                if (existingNilai) {
                    loadNilaiToForm(existingNilai);
                } else {
                    resetNilaiForm();
                }
            } else {
                formNilai.style.display = 'none';
            }
        });
        
        // Show rapor when siswa is selected
        document.getElementById('pilih-siswa-rapor').addEventListener('change', function() {
            const tampilanRapor = document.getElementById('tampilan-rapor');
            if (this.value) {
                tampilanRapor.style.display = 'block';
                generateRapor(this.value);
            } else {
                tampilanRapor.style.display = 'none';
            }
        });
        
        // Add siswa
        document.getElementById('tambah-siswa').addEventListener('click', function() {
            const nama = document.getElementById('nama').value;
            const jenisKelamin = document.getElementById('jenis-kelamin').value;
            const tempatLahir = document.getElementById('tempat-lahir').value;
            const tanggalLahir = document.getElementById('tanggal-lahir').value;
            const alamat = document.getElementById('alamat').value;
            const namaAyah = document.getElementById('nama-ayah').value;
            const namaIbu = document.getElementById('nama-ibu').value;
            const namaPanggilan = document.getElementById('nama-panggilan').value;
            const nisn = document.getElementById('nisn').value;
            const nis = document.getElementById('nis').value;
            const agama = document.getElementById('agama').value;
            const anakKe = document.getElementById('anak-ke').value;
            const pekerjaanAyah = document.getElementById('pekerjaan-ayah').value;
            const pekerjaanIbu = document.getElementById('pekerjaan-ibu').value;
            const noTelp = document.getElementById('no-telp').value;
            
            if (nama && jenisKelamin && tempatLahir && tanggalLahir) {
                const newSiswa = {
                    id: Date.now().toString(),
                    nama,
                    jenisKelamin,
                    tempatLahir,
                    tanggalLahir,
                    alamat,
                    namaAyah,
                    namaIbu,
                    namaPanggilan,
                    nisn,
                    nis,
                    agama,
                    anakKe,
                    pekerjaanAyah,
                    pekerjaanIbu,
                    noTelp
                };
                
                siswaData.push(newSiswa);
                localStorage.setItem('siswaData', JSON.stringify(siswaData));
                refreshSiswaTable();
                resetSiswaForm();
                
                alert('Siswa berhasil ditambahkan!');
            } else {
                alert('Harap lengkapi data siswa yang wajib!');
            }
        });
        
        // Save nilai
        document.getElementById('simpan-nilai').addEventListener('click', function() {
            const siswaId = document.getElementById('pilih-siswa').value;
            
            if (!siswaId) {
                alert('Pilih siswa terlebih dahulu!');
                return;
            }
            
            const nilaiAgama = document.getElementById('nilai-agama').value;
            const nilaiJatiDiri = document.getElementById('nilai-jati-diri').value;
            const nilaiLiterasi = document.getElementById('nilai-literasi').value;
            const nilaiKokurikuler = document.getElementById('nilai-kokurikuler').value;
            
            const tinggiSem1 = document.getElementById('tinggi-sem1').value;
            const tinggiSem2 = document.getElementById('tinggi-sem2').value;
            const beratSem1 = document.getElementById('berat-sem1').value;
            const beratSem2 = document.getElementById('berat-sem2').value;
            const lingkarSem1 = document.getElementById('lingkar-sem1').value;
            const lingkarSem2 = document.getElementById('lingkar-sem2').value;
            
            const kesehatanPendengaran = document.getElementById('kesehatan-pendengaran').value;
            const kesehatanPenglihatan = document.getElementById('kesehatan-penglihatan').value;
            const kesehatanGigi = document.getElementById('kesehatan-gigi').value;
            
            const sakit = document.getElementById('sakit').value;
            const izin = document.getElementById('izin').value;
            const tanpaKeterangan = document.getElementById('tanpa-keterangan').value;
            
            const catatanGuru = document.getElementById('catatan-guru').value;
            
            // Check if nilai already exists for this siswa
            const existingIndex = nilaiData.findIndex(n => n.siswaId === siswaId);
            
            const nilaiObj = {
                siswaId,
                nilaiAgama,
                nilaiJatiDiri,
                nilaiLiterasi,
                nilaiKokurikuler,
                fisik: {
                    tinggiSem1,
                    tinggiSem2,
                    beratSem1,
                    beratSem2,
                    lingkarSem1,
                    lingkarSem2
                },
                kesehatan: {
                    pendengaran: kesehatanPendengaran,
                    penglihatan: kesehatanPenglihatan,
                    gigi: kesehatanGigi
                },
                kehadiran: {
                    sakit,
                    izin,
                    tanpaKeterangan
                },
                catatanGuru
            };
            
            if (existingIndex !== -1) {
                // Update existing nilai
                nilaiData[existingIndex] = nilaiObj;
            } else {
                // Add new nilai
                nilaiData.push(nilaiObj);
            }
            
            localStorage.setItem('nilaiData', JSON.stringify(nilaiData));
            alert('Nilai berhasil disimpan!');
        });
        
        // Function to refresh siswa table
        function refreshSiswaTable() {
            const tabelSiswa = document.getElementById('tabel-siswa').getElementsByTagName('tbody')[0];
            tabelSiswa.innerHTML = '';
            
            siswaData.forEach((siswa, index) => {
                const row = tabelSiswa.insertRow();
                
                row.insertCell(0).textContent = index + 1;
                row.insertCell(1).textContent = siswa.nama;
                row.insertCell(2).textContent = siswa.jenisKelamin === 'L' ? 'Laki-laki' : 'Perempuan';
                row.insertCell(3).textContent = `${siswa.tempatLahir}/${formatDate(siswa.tanggalLahir)}`;
                row.insertCell(4).textContent = siswa.namaPanggilan;
                row.insertCell(5).textContent = `${siswa.nisn || '-'}/${siswa.nis || '-'}`;
                
                const actionCell = row.insertCell(6);
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Hapus';
                deleteButton.classList.add('delete');
                deleteButton.addEventListener('click', function() {
                    if (confirm(`Apakah Anda yakin ingin menghapus ${siswa.nama}?`)) {
                        // Remove siswa
                        siswaData = siswaData.filter(s => s.id !== siswa.id);
                        localStorage.setItem('siswaData', JSON.stringify(siswaData));
                        
                        // Remove associated nilai
                        nilaiData = nilaiData.filter(n => n.siswaId !== siswa.id);
                        localStorage.setItem('nilaiData', JSON.stringify(nilaiData));
                        
                        // Remove associated absensi
                        absensiData = absensiData.filter(a => a.siswaId !== siswa.id);
                        localStorage.setItem('absensiData', JSON.stringify(absensiData));
                        
                        refreshSiswaTable();
                        refreshSiswaDropdown();
                        refreshSiswaDropdownRapor();
                    }
                });
                
                actionCell.appendChild(deleteButton);
            });
        }
        
        // Function to reset siswa form
        function resetSiswaForm() {
            document.getElementById('nama').value = '';
            document.getElementById('jenis-kelamin').value = 'L';
            document.getElementById('tempat-lahir').value = '';
            document.getElementById('tanggal-lahir').value = '';
            document.getElementById('alamat').value = '';
            document.getElementById('nama-ayah').value = '';
            document.getElementById('nama-ibu').value = '';
            document.getElementById('nama-panggilan').value = '';
            document.getElementById('nisn').value = '';
            document.getElementById('nis').value = '';
            document.getElementById('agama').value = 'ISLAM';
            document.getElementById('anak-ke').value = '';
            document.getElementById('pekerjaan-ayah').value = '';
            document.getElementById('pekerjaan-ibu').value = '';
            document.getElementById('no-telp').value = '';
        }
        
        // Function to reset nilai form
        function resetNilaiForm() {
            document.getElementById('nilai-agama').value = '';
            document.getElementById('nilai-jati-diri').value = '';
            document.getElementById('nilai-literasi').value = '';
            document.getElementById('nilai-kokurikuler').value = '';
            
            document.getElementById('tinggi-sem1').value = '';
            document.getElementById('tinggi-sem2').value = '';
            document.getElementById('berat-sem1').value = '';
            document.getElementById('berat-sem2').value = '';
            document.getElementById('lingkar-sem1').value = '';
            document.getElementById('lingkar-sem2').value = '';
            
            document.getElementById('kesehatan-pendengaran').value = '';
            document.getElementById('kesehatan-penglihatan').value = '';
            document.getElementById('kesehatan-gigi').value = '';
            
            document.getElementById('sakit').value = '';
            document.getElementById('izin').value = '';
            document.getElementById('tanpa-keterangan').value = '';
            
            document.getElementById('catatan-guru').value = '';
        }
        
        // Function to load nilai to form
        function loadNilaiToForm(nilaiObj) {
            document.getElementById('nilai-agama').value = nilaiObj.nilaiAgama || '';
            document.getElementById('nilai-jati-diri').value = nilaiObj.nilaiJatiDiri || '';
            document.getElementById('nilai-literasi').value = nilaiObj.nilaiLiterasi || '';
            document.getElementById('nilai-kokurikuler').value = nilaiObj.nilaiKokurikuler || '';
            
            if (nilaiObj.fisik) {
                document.getElementById('tinggi-sem1').value = nilaiObj.fisik.tinggiSem1 || '';
                document.getElementById('tinggi-sem2').value = nilaiObj.fisik.tinggiSem2 || '';
                document.getElementById('berat-sem1').value = nilaiObj.fisik.beratSem1 || '';
                document.getElementById('berat-sem2').value = nilaiObj.fisik.beratSem2 || '';
                document.getElementById('lingkar-sem1').value = nilaiObj.fisik.lingkarSem1 || '';
                document.getElementById('lingkar-sem2').value = nilaiObj.fisik.lingkarSem2 || '';
            }
            
            if (nilaiObj.kesehatan) {
                document.getElementById('kesehatan-pendengaran').value = nilaiObj.kesehatan.pendengaran || '';
                document.getElementById('kesehatan-penglihatan').value = nilaiObj.kesehatan.penglihatan || '';
                document.getElementById('kesehatan-gigi').value = nilaiObj.kesehatan.gigi || '';
            }
            
            if (nilaiObj.kehadiran) {
                document.getElementById('sakit').value = nilaiObj.kehadiran.sakit || '';
                document.getElementById('izin').value = nilaiObj.kehadiran.izin || '';
                document.getElementById('tanpa-keterangan').value = nilaiObj.kehadiran.tanpaKeterangan || '';
            }
            
            document.getElementById('catatan-guru').value = nilaiObj.catatanGuru || '';
        }
        
        // Function to generate absensi table
        function generateAbsensiTable() {
            const container = document.getElementById('tabel-absensi-container');
            const bulan = document.getElementById('bulan-absensi').value;
            const tahun = document.getElementById('tahun-absensi').value;
            
            // Get days in month
            const daysInMonth = new Date(tahun, bulan, 0).getDate();
            
            let html = `
                <h3>Absensi Bulan ${getMonthName(bulan)} ${tahun}</h3>
                <div style="overflow-x: auto;">
                    <table class="attendance-table">
                        <thead>
                            <tr>
                                <th rowspan="2">No</th>
                                <th rowspan="2">Nama Siswa</th>
                                <th colspan="${daysInMonth}">Tanggal</th>
                                <th rowspan="2">Total Hadir</th>
                            </tr>
                            <tr>`;
            
            // Add day headers
            for (let i = 1; i <= daysInMonth; i++) {
                html += `<th>${i}</th>`;
            }
            
            html += `</tr></thead><tbody>`;
            
            // Add student rows
            siswaData.forEach((siswa, index) => {
                html += `<tr>
                    <td>${index + 1}</td>
                    <td>${siswa.nama}</td>`;
                
                // Add attendance cells for each day
                for (let i = 1; i <= daysInMonth; i++) {
                    const dateKey = `${tahun}-${bulan.padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                    const existingAbsensi = absensiData.find(a => a.siswaId === siswa.id && a.tanggal === dateKey);
                    
                    html += `<td>
                        <select class="absensi-select" data-siswa="${siswa.id}" data-tanggal="${dateKey}">
                            <option value="H" ${existingAbsensi && existingAbsensi.status === 'H' ? 'selected' : ''}>H</option>
                            <option value="S" ${existingAbsensi && existingAbsensi.status === 'S' ? 'selected' : ''}>S</option>
                            <option value="I" ${existingAbsensi && existingAbsensi.status === 'I' ? 'selected' : ''}>I</option>
                            <option value="A" ${existingAbsensi && existingAbsensi.status === 'A' ? 'selected' : ''}>A</option>
                        </select>
                    </td>`;
                }
                
                // Calculate total present days
                const totalHadir = absensiData.filter(a => a.siswaId === siswa.id && 
                    a.tanggal.startsWith(`${tahun}-${bulan.padStart(2, '0')}`) && 
                    a.status === 'H').length;
                
                html += `<td>${totalHadir}</td></tr>`;
            });
            
            html += `</tbody></table></div>`;
            
            container.innerHTML = html;
        }
        
        // Save absensi
        document.getElementById('simpan-absensi').addEventListener('click', function() {
            const absensiSelects = document.querySelectorAll('.absensi-select');
            
            absensiSelects.forEach(select => {
                const siswaId = select.getAttribute('data-siswa');
                const tanggal = select.getAttribute('data-tanggal');
                const status = select.value;
                
                // Check if absensi already exists
                const existingIndex = absensiData.findIndex(a => a.siswaId === siswaId && a.tanggal === tanggal);
                
                if (existingIndex !== -1) {
                    // Update existing absensi
                    absensiData[existingIndex].status = status;
                } else {
                    // Add new absensi
                    absensiData.push({
                        siswaId,
                        tanggal,
                        status
                    });
                }
            });
            
            localStorage.setItem('absensiData', JSON.stringify(absensiData));
            alert('Absensi berhasil disimpan!');
            generateAbsensiTable(); // Refresh table to update totals
        });
        
        // Function to generate rapor
        function generateRapor(siswaId) {
            const siswa = siswaData.find(s => s.id === siswaId);
            const nilai = nilaiData.find(n => n.siswaId === siswaId);
            
            if (!siswa) return;
            
            // Fill student info
            document.getElementById('nama-rapor').textContent = siswa.nama;
            document.getElementById('nama-panggilan-rapor').textContent = siswa.namaPanggilan || '-';
            document.getElementById('nisn-nis-rapor').textContent = `${siswa.nisn || '-'} / ${siswa.nis || '-'}`;
            document.getElementById('jenis-kelamin-rapor').textContent = siswa.jenisKelamin === 'L' ? 'Laki-laki' : 'Perempuan';
            document.getElementById('ttl-rapor').textContent = `${siswa.tempatLahir}, ${formatDate(siswa.tanggalLahir)}`;
            document.getElementById('agama-rapor').textContent = siswa.agama || '-';
            document.getElementById('anak-ke-rapor').textContent = siswa.anakKe || '-';
            
            // Fill nilai if available
            if (nilai) {
                document.getElementById('rapor-agama').textContent = nilai.nilaiAgama || '-';
                document.getElementById('rapor-jati-diri').textContent = nilai.nilaiJatiDiri || '-';
                document.getElementById('rapor-literasi').textContent = nilai.nilaiLiterasi || '-';
                document.getElementById('rapor-kokurikuler').textContent = nilai.nilaiKokurikuler || '-';
                
                // Fill fisik data
                const raporFisik = document.getElementById('rapor-fisik');
                raporFisik.innerHTML = '';
                
                if (nilai.fisik) {
                    const row1 = raporFisik.insertRow();
                    row1.insertCell(0).textContent = 'Tinggi Badan';
                    row1.insertCell(1).textContent = nilai.fisik.tinggiSem1 ? `${nilai.fisik.tinggiSem1} cm` : '-';
                    row1.insertCell(2).textContent = nilai.fisik.tinggiSem2 ? `${nilai.fisik.tinggiSem2} cm` : '-';
                    
                    const row2 = raporFisik.insertRow();
                    row2.insertCell(0).textContent = 'Berat Badan';
                    row2.insertCell(1).textContent = nilai.fisik.beratSem1 ? `${nilai.fisik.beratSem1} kg` : '-';
                    row2.insertCell(2).textContent = nilai.fisik.beratSem2 ? `${nilai.fisik.beratSem2} kg` : '-';
                    
                    const row3 = raporFisik.insertRow();
                    row3.insertCell(0).textContent = 'Lingkar Kepala';
                    row3.insertCell(1).textContent = nilai.fisik.lingkarSem1 ? `${nilai.fisik.lingkarSem1} cm` : '-';
                    row3.insertCell(2).textContent = nilai.fisik.lingkarSem2 ? `${nilai.fisik.lingkarSem2} cm` : '-';
                }
                
                // Fill kesehatan data
                const raporKesehatan = document.getElementById('rapor-kesehatan');
                raporKesehatan.innerHTML = '';
                
                if (nilai.kesehatan) {
                    const row1 = raporKesehatan.insertRow();
                    row1.insertCell(0).textContent = 'Pendengaran';
                    row1.insertCell(1).textContent = nilai.kesehatan.pendengaran || '-';
                    
                    const row2 = raporKesehatan.insertRow();
                    row2.insertCell(0).textContent = 'Penglihatan';
                    row2.insertCell(1).textContent = nilai.kesehatan.penglihatan || '-';
                    
                    const row3 = raporKesehatan.insertRow();
                    row3.insertCell(0).textContent = 'Gigi';
                    row3.insertCell(1).textContent = nilai.kesehatan.gigi || '-';
                }
                
                // Fill kehadiran data
                if (nilai.kehadiran) {
                    document.getElementById('rapor-sakit').textContent = nilai.kehadiran.sakit || '0';
                    document.getElementById('rapor-izin').textContent = nilai.kehadiran.izin || '0';
                    document.getElementById('rapor-tanpa-keterangan').textContent = nilai.kehadiran.tanpaKeterangan || '0';
                }
                
                // Catatan guru
                document.getElementById('catatan-guru-rapor').textContent = nilai.catatanGuru || '-';
            } else {
                // Clear all if no nilai
                document.getElementById('rapor-agama').textContent = '-';
                document.getElementById('rapor-jati-diri').textContent = '-';
                document.getElementById('rapor-literasi').textContent = '-';
                document.getElementById('rapor-kokurikuler').textContent = '-';
                
                document.getElementById('rapor-fisik').innerHTML = '';
                document.getElementById('rapor-kesehatan').innerHTML = '';
                
                document.getElementById('rapor-sakit').textContent = '0';
                document.getElementById('rapor-izin').textContent = '0';
                document.getElementById('rapor-tanpa-keterangan').textContent = '0';
                
                document.getElementById('catatan-guru-rapor').textContent = '-';
            }
        }
        
        // Helper function to format date
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID');
        }
        
        // Helper function to get month name
        function getMonthName(monthNumber) {
            const months = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
            ];
            return months[parseInt(monthNumber) - 1];
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            refreshSiswaTable();
            refreshSiswaDropdown();
            refreshSiswaDropdownRapor();
            
            // Add sample data if empty
            if (siswaData.length === 0) {
                // Add sample students from your Excel file
                const sampleStudents = [
                    {
                        id: '1',
                        nama: 'Abian Alfarizi',
                        jenisKelamin: 'L',
                        tempatLahir: 'Jakarta',
                        tanggalLahir: '2020-07-09',
                        alamat: 'Jl.Kampung Baru Rt11 Rw16,Penjaringan',
                        namaAyah: 'Aldi.A',
                        namaIbu: 'Sintia.p.p',
                        namaPanggilan: 'Bian',
                        nisn: '3203483062',
                        nis: '0731',
                        agama: 'ISLAM',
                        anakKe: '1',
                        pekerjaanAyah: 'Karyawan swasta',
                        pekerjaanIbu: 'Karyawan swasta',
                        noTelp: '081311599941'
                    },
                    {
                        id: '2',
                        nama: 'Fazel Alfatih',
                        jenisKelamin: 'L',
                        tempatLahir: 'Jakarta',
                        tanggalLahir: '2019-10-15',
                        alamat: 'Jl.Karta Jaya 3,Penjaringan',
                        namaAyah: 'Roni.K',
                        namaIbu: 'Suhaemi',
                        namaPanggilan: 'Azel',
                        nisn: '3196341320',
                        nis: '0728',
                        agama: 'ISLAM',
                        anakKe: '1',
                        pekerjaanAyah: 'Karyawan swasta',
                        pekerjaanIbu: 'Ibu rumah tangga',
                        noTelp: '085210150782'
                    }
                ];
                
                siswaData = sampleStudents;
                localStorage.setItem('siswaData', JSON.stringify(siswaData));
                refreshSiswaTable();
                refreshSiswaDropdown();
                refreshSiswaDropdownRapor();
            }
        });
    </script>
</body>
</html>